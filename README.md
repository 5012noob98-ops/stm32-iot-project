# STM32 IoT设备开发项目

## 项目简介

这是一个基于STM32的IoT设备开发项目，实现了完整的物联网功能，包括本地控制和远程控制。项目采用模块化设计，具有良好的可扩展性和可维护性。

## 硬件平台

- **主控芯片**: STM32F103C8T6 (ARM Cortex-M3)
- **WiFi模块**: ESP8266
- **按键输入**: 2个独立按键 (KEY1, KEY2)
- **LED指示**: 2个LED灯 (LED1, LED2)
- **通信接口**: UART4, DMA,USART1

## 软件架构

### 模块划分
1. **LED控制模块** (`led_control.h/.c`) - 负责LED状态控制和闪烁频率设置
2. **按键处理模块** (`key_handler.h/.c`) - 实现完整的按键状态机
3. **ESP8266驱动模块** (`esp8266_driver.h/.c`) - 负责WiFi连接和MQTT通信
4. **云平台接口模块** (`cloud_interface.h/.c`) - 处理设备状态上报和命令解析
5. **UART驱动模块** (`usart_driver.h/.c`) - 处理串口数据接收和命令处理
6. **定时器处理模块** (`timer_handler.h/.c`) - 管理系统时钟节拍和定时任务

## 功能特性

### 本地控制
- **单击KEY1**: 切换LED状态（LED1→LED2→LED1+LED2→全灭）
- **双击KEY1**: LED闪烁模式
- **长按KEY1**: 关闭所有LED
- **KEY1+KEY2长按**: 进入配置模式，可调整闪烁频率

### 远程控制
- 通过MQTT协议与阿里云IoT平台通信
- 支持远程控制LED开关
- 支持设置LED闪烁频率
- 定时上报设备状态

### 串口调试
- 支持简单命令控制（LED ON/OFF, BLINK, GET CONFIG）
- 实时输出调试信息

## 开发环境

- **IDE**: Keil MDK v5.36
- **编程语言**: C语言
- **SDK**: STM32 HAL库
- **通信协议**: MQTT, AT指令
- **第三方库**: cJSON (JSON解析)

## 项目进展

- [x] 完成模块化架构设计
- [x] 实现基本功能
- [x] 项目文档整理


## 技术亮点

### 1. 模块化设计
- 高内聚低耦合的模块划分
- 清晰的接口定义
- 便于维护和扩展

### 2. 状态机设计
- 按键处理采用完整状态机
- 支持单击、双击、长按等复杂操作
- 配置模式支持参数调整

### 3. 通信协议处理
- 完整的WiFi和MQTT连接管理
- AT指令交互和错误处理
- JSON数据解析和生成

### 4. 实时系统概念
- 定时器中断处理
- DMA数据传输
- 多任务协调

## 学习成果

通过本项目，掌握了以下技能：
1. STM32嵌入式开发
2. WiFi通信与MQTT协议
3. 模块化软件设计
4. 实时系统概念
5. IoT设备开发流程
6. Git版本控制
7. 问题调试和解决能力

## 编译和烧录

### 编译步骤
1. 打开 Keil MDK
2. 加载项目文件 `MDK-ARM/demo08.uvprojx`
3. 编译项目 (Project -> Build)

### 烧录步骤
1. 连接ST-Link调试器
2. 点击下载按钮或选择 (Flash -> Download)

## 使用说明

### 硬件连接
1. 确保ST-Link调试器正确连接
2. ESP8266模块连接到UART4
3. 按键和LED按照原理图连接

### 调试接口
- USART1 用于调试信息输出 (115200bps)
- 可通过串口助手查看运行状态

### 常用命令

- LED ON          打开所有LED
- LED LED OFF     关闭所有LED
- LED BLINK 500   设置LED闪烁间隔为500ms 
- GET CONFIG      获取当前配置信息

### 调试技巧
1. 使用串口助手连接USART1查看调试信息
2. 通过AT指令直接测试ESP8266功能
3. 观察LED状态了解系统运行情况
4. 查看串口输出的日志信息定位问题

